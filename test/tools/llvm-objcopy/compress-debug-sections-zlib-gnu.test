# REQUIRES: zlib

# Reuse compress-debug-sections.test.
# Here we are testing that zlib-gnu properly sets the right magic header and
# also roundtrips properly.

# RUN: yaml2obj %S/compress-debug-sections.test -o %t.o
# RUN: llvm-objcopy --compress-debug-sections=zlib-gnu %t.o %t-zlib-gnu.o
# RUN: llvm-objcopy --decompress-debug-sections %t-zlib-gnu.o %t-decompressed.o
# RUN: wc -c %t.o | FileCheck %s -check-prefix=SIZE-ORIGINAL
# RUN: wc -c %t-zlib-gnu.o | FileCheck %s -check-prefix=SIZE-COMPRESSED

# RUN: llvm-objdump -s %t.o -section=.debug_str | FileCheck %s
# RUN: llvm-objdump -s %t-zlib-gnu.o | FileCheck %s --check-prefix=CHECK-ZLIB-GNU
# RUN: llvm-objdump -s %t-decompressed.o -section=.debug_str | FileCheck %s

# CHECK: .debug_str
# CHECK: clang

# CHECK-ZLIB-GNU: .zdebug_str
# CHECK-ZLIB-GNU: 000001c6
# CHECK-ZLIB-GNU: ZLIB

# CHECK-ZLIB-GNU: .zdebug_info
# CHECK-ZLIB-GNU: 00000068
# CHECK-ZLIB-GNU: ZLIB

# CHECK-ZLIB-GNU: .zdebug_line
# CHECK-ZLIB-GNU: 0000004f
# CHECK-ZLIB-GNU: ZLIB

# SIZE-ORIGINAL: 2456
# SIZE-COMPRESSED: 2168

